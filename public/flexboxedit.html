<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WYSIWYG Flexbox Editor</title>

    <link href="./flexboxedit.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/simply-beautiful@latest/dist/index.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.js"></script>
</head>
<body>

<div style="display: flex; flex-direction: row;flex: 1; height: 100%; width: 100%;">
  <div data-holder-explorer style="display: flex; flex-direction: column; ">
  </div>

  <div data-holder-main style="display: flex; flex-direction: column; flex: 1; width: 0;">
  </div>
</div>

<div domEditorArea id="editor">
</div>
<div domEditorAreaHidden style="display: none;">
</div>


<div class="explorer" data-explorer-itemlist style="display: flex; flex-direction: column; overflow-y: auto; height: 100%; width: 250px; ">
  <div class="explorer-item">asd</div>
</div>


<div class="controls" data-toolbar-itemmeta>
  <label>Name</label>
  <input type="text" data-input-itemmeta-name autocapitalize="false" autocorrect="false" autocomplete="false" style="width: 250px;" />
  <label>ID</label>
  <input type="text" data-input-itemmeta-id autocapitalize="false" autocorrect="false" autocomplete="false" readonly style="width: 250px;" />
  <label>Embed</label>
  <input type="text" data-input-itemmeta-embed autocapitalize="false" autocorrect="false" autocomplete="false" readonly style="width: 250px;" />
</div>

<div class="controls" data-toolbar-menu>
    <button data-btn-loadsave-new>New</button>
    <button data-btn-editlayout>Edit Layout Mode</button>
    <button data-btn-editcontent>Edit Content Mode</button>
    <input type="checkbox" data-toggle-displaytaglabels checked /><label>Display tag labels</label>
    <button data-btn-edititeminnerhtml>Edit Item Inner HTML</button>
    <button data-btn-preview>Preview Webpage</button>
</div>

<div class="controls" data-toolbar-edit-layout style="width: 100%; overflow-x: auto;">
  <div style="display: flex; flex-direction: column;">
    <button style="flex: 1; width: 200px;" id="addItem">Add Item into Selected Flexbox</button>
    <button style="flex: 1; width: 200px;" id="addItemBeforeSibling">Add Item before Selected Flexbox</button>
    <button style="flex: 1; width: 200px;" id="addItemAfterSibling">Add Item after Selected Flexbox</button>
    <div style="display: flex; flex-direction: row; width: 200px; flex: 1;">
      <button style="flex: 1;" id="moveItemCut">Cut</button>
      <button style="flex: 1;" id="moveItemCopy">Copy</button>
      <button style="flex: 1;" id="moveItemPaste">Paste</button>
    </div>
    <button style="flex: 1; width: 200px;" id="moveItemToBefore">Shift Up...</button>
    <button style="flex: 1; width: 200px;" id="moveItemToAfter">Shift down...</button>
  </div>
  <div style="display: flex; flex-direction: column;">
    <button style="flex: 1; height: 0; width: 70px;" id="removeItem">Remove Selected Item</button>
    <button style="width: 70px;" id="moveItemReplace">Replace Selected Item</button>
  </div>

  <fieldset style="flex: 1; padding: 0 10px;">
    <legend>
      <button data-btn-edit-tab-layout-flexbox>Layout / Flexbox</button>
      <button data-btn-edit-tab-layout-attr>Core Attributes</button>
    </legend>

    <div class="controls" style="height: 340px; overflow-y: auto;">

      <div class="controls" data-toolbar-edit-layout-flexbox>

        <label>
            Display:
            <select id="display" size="11">
                <option value=""></option>
                <option value="initial">initial</option>
                <option value="inherit">inherit</option>
                <option value="flex">flex</option>
                <option value="block">block</option>
                <option value="inline">inline</option>
                <option value="inline-block">inline-block</option>
                <option value="inline-flex">inline-flex</option>
                <option value="grid">grid</option>
                <option value="inline-grid">inline-grid</option>
                <option value="flow-root">flow-root</option>
            </select>
        </label>
        <span style="display: flex; flex-direction: column;">
          <label>
              Flex Direction:
              <select id="flexDirection" size="7">
                  <option value=""></option>
                  <option value="initial">initial</option>
                  <option value="inherit">inherit</option>
                  <option value="row">Row</option>
                  <option value="row-reverse">Row Reverse</option>
                  <option value="column">Column</option>
                  <option value="column-reverse">Column Reverse</option>
              </select>
          </label>
          <label>
              Justify Content:
              <select id="justifyContent" size="9">
                  <option value=""></option>
                  <option value="initial">initial</option>
                  <option value="inherit">inherit</option>
                  <option value="flex-start">Start</option>
                  <option value="flex-end">End</option>
                  <option value="center">Center</option>
                  <option value="stretch">Stretch</option>
                  <option value="space-between">Space Between</option>
                  <option value="space-around">Space Around</option>
              </select>
          </label>
        </span>
        <span style="display: flex; flex-direction: column;">
          <label>
              Align Items:
              <select id="alignItems" size="7">
                  <option value=""></option>
                  <option value="initial">initial</option>
                  <option value="inherit">inherit</option>
                  <option value="stretch">Stretch</option>
                  <option value="flex-start">Start</option>
                  <option value="flex-end">End</option>
                  <option value="center">Center</option>
              </select>
          </label>
          <label>
              Align Self:
              <select id="alignSelf" size="7">
                  <option value=""></option>
                  <option value="initial">initial</option>
                  <option value="inherit">inherit</option>
                  <option value="stretch">Stretch</option>
                  <option value="flex-start">Start</option>
                  <option value="flex-end">End</option>
                  <option value="center">Center</option>
              </select>
          </label>
        </span>
        <span style="display: flex; flex-direction: column;">
          <label>
              Flex:
              <input type="text" id="flex" />
          </label>
          <label>
              Gap:
              <input type="text" id="gap" />
          </label>
          <label>
              Padding:
              <input type="text" id="padding" />
          </label>
          <label>
              Margin:
              <input type="text" id="margin" />
          </label>


          <label>
              Justify Self:
              <select id="justifySelf" size="9">
                  <option value=""></option>
                  <option value="initial">initial</option>
                  <option value="inherit">inherit</option>
                  <option value="flex-start">Start</option>
                  <option value="flex-end">End</option>
                  <option value="center">Center</option>
                  <option value="stretch">Stretch</option>
                  <option value="space-between">Space Between</option>
                  <option value="space-around">Space Around</option>
              </select>
          </label>

        </span>
        <span style="display: flex; flex-direction: column;">
          <label>
              Width:
              <input type="text" id="width" />
          </label>
          <label>
              Height:
              <input type="text" id="height" />
          </label>
          <label>
              Min Width:
              <input type="text" id="minWidth" />
          </label>
          <label>
              Min Height:
              <input type="text" id="minHeight" />
          </label>
          <label>
              Max Width:
              <input type="text" id="maxWidth" />
          </label>
          <label>
              Max Height:
              <input type="text" id="maxHeight" />
          </label>
        </span>
        <label>
            Position:
            <select id="position" size="8">
                <option value=""></option>
                <option value="inherit">inherit</option>
                <option value="initial">initial</option>
                <option value="static">static</option>
                <option value="relative">relative</option>
                <option value="absolute">absolute</option>
                <option value="fixed">fixed</option>
                <option value="sticky">sticky</option>
            </select>
        </label>
        <span style="display: flex; flex-direction: column;">
          <label>
              Text Align:
              <select id="text-align" size="6">
                  <option value=""></option>
                  <option value="inherit">inherit</option>
                  <option value="initial">initial</option>
                  <option value="left">left</option>
                  <option value="right">right</option>
                  <option value="center">center</option>
              </select>
          </label>
          <label>
              Vertical Align:
              <select id="vertical-align" size="9">
                  <option value=""></option>
                  <option value="inherit">inherit</option>
                  <option value="initial">initial</option>
                  <option value="baseline">baseline</option>
                  <option value="top">top</option>
                  <option value="middle">middle</option>
                  <option value="bottom">bottom</option>
                  <option value="sub">sub</option>
                  <option value="text-top">text-top</option>
              </select>
          </label>
        </span>
        <span style="display: flex; flex-direction: column;">
          <label>
            Overflow-x:
            <select id="overflow-x" size="7">
                <option value=""></option>
                <option value="inherit">inherit</option>
                <option value="initial">initial</option>
                <option value="auto">auto</option>
                <option value="scroll">scroll</option>
                <option value="hidden">hidden</option>
                <option value="visible">visible</option>
            </select>
          </label>
          <label>
            Overflow-y:
            <select id="overflow-y" size="7">
                <option value=""></option>
                <option value="inherit">inherit</option>
                <option value="initial">initial</option>
                <option value="auto">auto</option>
                <option value="scroll">scroll</option>
                <option value="hidden">hidden</option>
                <option value="visible">visible</option>
            </select>
          </label>
        </span>
        <span style="display: flex; flex-direction: column;">
          <label>
              Left:
              <input type="text" id="left" />
          </label>
          <label>
              Top:
              <input type="text" id="top" />
          </label>
          <label>
              Right:
              <input type="text" id="right" />
          </label>
          <label>
              Bottom:
              <input type="text" id="bottom" />
          </label>
        </span>

      </div>

      <div class="controls" data-toolbar-edit-layout-attr>
        <span style="display: flex; flex-direction: column;">
          <label>
              id:
          </label>
          <input type="text" id="id" style="width: 200px;" />
          <label>
              className:
          </label>
          <textarea id="className" style="height: 200px; width: 200px;"></textarea>
        </span>
        <span class="controls" style="display: flex; flex-direction: column;">
          <span style="display: flex; flex-direction: column;">
            <label>
                dataset:
            </label>
            <div id="dataset" ></div>
          </span>
        </span>
      </div>


    </div>

  </fieldset>


  <div style="display: flex; flex-direction: column; gap: 10px; width: 150px;">
    <div style="display: flex; flex-direction: column; ">
      <div style="display: flex; flex-direction: row; ">
        <label>Source JSON</label>
      </div>

      <div style="display: flex; flex-direction: column; justify-content: stretch;">
        <div style="display: flex; flex-direction: row; flex: 1; align-items: stretch;">
          <button data-btn-dbg-copy>Copy JSON</button>
          <button data-btn-dbg-import>Import JSON</button>
        </div>
      </div>

      <textarea data-dbg style="width: 250px; flex: 1; display: none;"></textarea>
    </div>
    <div style="display: flex; flex-direction: column; ">
      <div style="display: flex; flex-direction: row; flex: 1; align-items: stretch;">
        <label>Export HTML</label>
      </div>
      <button data-btn-dbg-copy-html>Copy HTML</button>
      <textarea data-result style="width: 250px; flex: 1; display: none;"></textarea>
    </div>
  </div>

</div>

<div class="controls" data-toolbar-edit-content>
</div>



<div data-overlay-editor-holder style="display: none; flex-direction: column; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; 
align-items: stretch;
background: rgba(0,0,0,0.5); padding: 10px; box-sizing: border-box;">
  <div style="display: flex; flex-direction: row; padding: 10px; gap: 10px; box-sizing: border-box;">
    <div style="flex: 1;"></div>
    <button data-btn-overlayeditorclose>Close</button>
  </div>
  <div style="flex: 1; position:relative; background: #fff; padding: 10px;">
    <div data-overlay-editor></div>
  </div>
</div>


<div data-overlay-preview-holder style="display: none; flex-direction: column; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; 
align-items: stretch;
background: rgba(0,0,0,0.5); padding: 10px; box-sizing: border-box;">
  <div style="display: flex; flex-direction: row; padding: 10px; gap: 10px; box-sizing: border-box;">
    <div style="flex: 1;"></div>
    <button data-btn-overlaypreviewclose>Close</button>
  </div>
  <div style="flex: 1; position:relative; background: #fff; padding: 10px; display: flex; align-items: stretch;">
    <div data-overlay-preview style="flex: 1; position:relative; display: flex; align-items: stretch;"></div>
  </div>
</div>


<script src="./flexboxedit.templateeditorcore.js"></script>
<script src="./flexboxedit.templateeditorpanel.js"></script>
<script src="./flexboxedit.templateeditorpanelflexbox.js"></script>
<script src="./flexboxedit.templateeditorpanelattr.js"></script>
<script src="./flexboxedit.rendercore.js"></script>
<script src="./flexboxedit.htmleditor.summernote.js"></script>
<script src="./flexboxedit.loadsave.js"></script>

<script>
  (async () => {
    const fbeTemplateEditorCore = await FlexboxEdit.TemplateEditorCore.initialize();
    const fbeTemplateEditorPanel = await FlexboxEdit.TemplateEditorPanel.initialize({
      templateEditorCoreInstance: fbeTemplateEditorCore,
    });
    const fbeTemplateEditorPanelFlexbox = await FlexboxEdit.TemplateEditorPanelFlexbox.initialize({
      templateEditorCoreInstance: fbeTemplateEditorCore,
      templateEditorPanelInstance: fbeTemplateEditorPanel,
    });
    const fbeTemplateEditorPanelAttr = await FlexboxEdit.TemplateEditorPanelAttr.initialize({
      templateEditorCoreInstance: fbeTemplateEditorCore,
      templateEditorPanelInstance: fbeTemplateEditorPanel,
    });
    await fbeTemplateEditorPanel.createNewItem();

    const doSave = async ({
      id,
      name,
      json,
    }) => {
      const res = await FlexboxEdit.LoadSave.applySave(id, {
        name,
        json,
      });

      if (!id) {
        await doLoadList();

        await fbeTemplateEditorPanel.loadItem({
          id: res.data.id,
          name: res.data.name,
          json: JSON.parse(res.data.json),
        });
      }

      if (res.data) {
        fbeTemplateEditorPanel.domExplorerItemlist.querySelectorAll(`[data-explorer-item-id="${res.data.id}"]`).forEach((dom) => {
          dom.item = res.data;
          dom.domName.innerHTML = res.data.name?.trim() || `Untitled`;
        });
      }
    }


    const doLoadList = async () => {

      const reslist = await FlexboxEdit.LoadSave.applyLoadList();

      fbeTemplateEditorPanel.domExplorerItemlist.innerHTML = "";

      for (var k in reslist.data) {
        const item = reslist.data[k];

        const domContainer = document.createElement('div');

        domContainer.innerHTML = `
<div class="explorer-item" data-explorer-item data-explorer-item-id="${item.id}">
  <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
    <div data-explorer-item-name style="flex: 1;">
      ${item.name?.trim() || `<span style="font-style: italic; color: rgb(100,100,100);">Untitled</span>`}
    </div>
    <div data-explorer-item-remove>
      [x]
    </div>
  </div>
</div>
`;

        const dom = domContainer.children[0];
        dom.domName = dom.querySelector('[data-explorer-item-name]');
        dom.item = item;

        fbeTemplateEditorPanel.domExplorerItemlist.append(dom);
      }

    }


    const removeItem = async () => {

      await FlexboxEdit.LoadSave.applyRemove();

      fbeTemplateEditorPanel.domExplorerItemlist.querySelectorAll(`[data-explorer-item-id="${res.data.id}"]`).forEach((dom) => {
        dom.remove();
      });

    }



    fbeTemplateEditorCore.setOnUpdateItem( async ({ isUpdate, id, name, json, }) => {
      if (isUpdate) {
        await doSave({id, name, json, });
      }
    });



    fbeTemplateEditorCore.setOnUpdateItemMeta( async ({ isUpdate, id, name, json, }) => {
      if (isUpdate) {
        await doSave({id, name, json, });
      }
    });



    fbeTemplateEditorPanel.domExplorerItemlist.addEventListener('click', async (e) => {
      e.preventDefault();

      const domItemRemove = e.target.closest(`[data-explorer-item-remove]`);
      const domItem = e.target.closest(`[data-explorer-item]`);

      if (domItemRemove) {

        const res = await FlexboxEdit.LoadSave.applyRemove(domItem.item.id);
        domItem.remove();

      } else if (domItem) {

        const res = await FlexboxEdit.LoadSave.applyLoad(domItem.item.id);
        await fbeTemplateEditorPanel.loadItem({
          id: res.data.id,
          name: res.data.name,
          json: res.data.json ? JSON.parse(res.data.json) : undefined,
        });

      }
    });

    await doLoadList();

  })();
</script>



</body>
</html>